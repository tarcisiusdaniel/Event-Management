version: 0.2

phases:
  install:
    commands:
      # Install Docker
      - echo Installing Docker...
      - yum update -y
      - yum install docker
      # - amazon-linux-extras install docker
      - service docker start
      - usermod -a -G docker ec2-user
      - chmod 666 /var/run/docker.sock

      # Install Docker Compose
      - echo Installing Docker Compose...
      - curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
      - chmod +x /usr/local/bin/docker-compose
      - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
  
  build:
    commands:
      # Run Docker Compose to build and start services
      - echo Building and starting services using docker-compose...
      - docker-compose up --build -d
  
  # post_build

artifacts:
  files:
    - '**/*'